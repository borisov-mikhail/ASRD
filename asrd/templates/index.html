<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">

    <title>ASRD</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
        crossorigin="anonymous"
    >
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"
    ></script>

    <style>
      .content div {
        width: 100%;
        height: 400px
      }

      body {
        font-size: .875rem;
      }

      .sidebar {
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
      }

      .sidebar .nav-link {
        font-weight: 500;
        color: #333;
      }

      .sidebar .nav-link.active {
        color: #007bff;
      }

      .sidebar-heading {
        font-size: .75rem;
        text-transform: uppercase;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark shadow flex-md-nowrap">
      <a href="/" class="navbar-brand col-md-3 col-lg-2 me-0 px-3">
        ASRD
      </a>

      <div class="container-fluid">
        <form class="d-flex" method="post" action="/upload-srb-data/" enctype="multipart/form-data">
          <input
            class="form-control me-2"
            type="file"
            name="file"
            required
            aria-label="Upload SRB file"
          >

          <button class="btn btn-light" type="submit">Upload</button>
        </form>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
          <div class="position-sticky pt-3">
            <h2 class="h6 sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">Samples</h2>

            {% if samples %}
              <ul class="nav flex-column">
                {% for index, name in samples %}
                  <li class="nav-item">
                    <a class="nav-link {% if index == sample_index %}active{% endif %}" href="/view/{{file}}/{{index}}">{{name}}</a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div>
            {% with messages = get_flashed_messages() %}
              {% if messages %}
                <ul>
                  {% for message in messages %}
                    <li>{{ message }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            {% endwith %}
          </div>

          <div id="plot_container" class="content"></div>
        </main>
      </div>
    </div>

    {% if graph %}
      <script
        src="https://cdn.jsdelivr.net/npm/echarts@5.0.2/dist/echarts.min.js"
        integrity="sha256-NZlQFkif+Cpc0rqEGGpSmaU55Vw4aMWK5KC3BRACd/Q="
        crossorigin="anonymous"
      ></script>

      <script>
        function loadData() {
          const [guid, sample] = location.pathname.split('/').slice(2, 4)

          return fetch(`/api/points/${guid}/${sample}`)
            .then(response => response.json())
        }

        function renderPlot(wrapper, data) {
          const container = document.createElement('div');
          wrapper.appendChild(container);

          const chart = window.echarts.init(container);

          chart.setOption({
            xAxis: {
              type: 'category',
              data: data.x,
            },
            yAxis: {
              type: 'value'
            },
            series: [{
              data: data.data,
              type: 'line'
            }]
          });
        }

        const plot_container = document.getElementById('plot_container');
        if (plot_container) {
          loadData().then(data => {
            data.forEach(plot_data => renderPlot(plot_container, plot_data));
          });
        }
      </script>
    {% endif %}
  </body>
</html>